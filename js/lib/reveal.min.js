/**
 * Buzz Brothers Reveal Slider jQuery Plugin
 *
 * This plugin allow to create a slider with a reveal/scan effect and more...
 *
 * @author	Pauline Dupraz 
 * @created	31.03.2012
 * @updated	31.03.2012
 * @version	1.0
 */
(function(c){function d(f,e){this.settings={draggable:true,navigation:true,navigationTransitionSpeed:200,animation:false,speed:1000,delay:2000,timeoutClassChangeMedia:500,callbackChangeMedia:null,direction:"lr",fixedDragger:false,wrapperOffset:0,draggerStartOffset:0,changeMediaOffset:0,wrapper:".wrapper",dragger:".dragger",front:".covered",back:".back"},this.$refs={slider:"",slides:"",wrapper:"",dragger:"",front:"",back:"",navigation:""};this.currentIndex=0;this.total=0;this.multipleSlides=false;this.changed="";this.is_mousedown=false;this.is_loadingMedia=false;this.navigationChanged=false;this.width=0;this.height=0;this.$this;this.init(c(f),e)}d.prototype.init=function(g,f){var i=this,h=c(g);i.$this=h;if(f){c.extend(i.settings,f)}i.$refs.slider=h;i.$refs.dragger=h.find(i.settings.dragger);i._rewriteSliderOutput();i.total=i.$refs.slides.length-1;i.width=h.width();i.height=h.height();i.multipleSlides=(i.total>2)?true:false;i.settings.changeMediaOffset=i._setPercentinPixel(i.settings.changeMediaOffset);var e=0;switch(i.settings.direction.toUpperCase()){case"LR":i.changed="back";i.currentIndex=i.getIndex();e=(i.currentIndex+1<=i.total)?i.currentIndex+1:0;i.$refs.front.html(c(i.$refs.slides[e]));i.$refs.back.html(c(i.$refs.slides[i.currentIndex]));i.currentIndex++;break;case"RL":i.changed="front";i.currentIndex=(i.currentIndex+1>i.total-1)?0:i.currentIndex+1;e=(i.currentIndex-1>=0)?i.currentIndex-1:i.total;i.$refs.front.html(c(i.$refs.slides[e]));i.$refs.back.html(c(i.$refs.slides[i.currentIndex]));break;case"TB":i.changed="back";i.currentIndex=i.getIndex();e=(i.currentIndex+1<=i.total)?i.currentIndex+1:0;i.$refs.front.html(c(i.$refs.slides[e]));i.$refs.back.html(c(i.$refs.slides[i.currentIndex]));i.currentIndex++;break;case"BT":i.changed="front";i.currentIndex=(i.currentIndex+1>i.total-1)?0:i.currentIndex+1;e=(i.currentIndex-1>=0)?i.currentIndex-1:i.total;i.$refs.front.html(c(i.$refs.slides[e]));i.$refs.back.html(c(i.$refs.slides[i.currentIndex]));break}i._initCss();i._resize();if(i.settings.navigation===true){i.navigation()}if(i.settings.animation===true){i.animation()}if(i.settings.draggable===true){i.mouseHandler()}if(i.settings.callbackChangeMedia!=null){i._loadingState()}};d.prototype._rewriteSliderOutput=function(){var j=this,i=j.$this;var f=j.settings.wrapper;f=f.substr(1,f.length);var h=j.settings.front;h=h.substr(1,h.length);var g=j.settings.back;g=g.substr(1,g.length);var e='<ul class="'+f+'"><li class="'+h+'"></li><li class="'+g+'"></li></ul>';i.find(j.$refs.dragger).remove();j.$refs.slides=i.find(j.settings.wrapper).children();j.$refs.slider.empty().html(e);j.$refs.wrapper=i.find(j.settings.wrapper);j.$refs.front=i.find(j.settings.front);j.$refs.back=i.find(j.settings.back);j.$refs.slider.prepend(j.$refs.dragger)};d.prototype._initCss=function(){var i=this,g=i.$this;var h=i.settings.draggerStartOffset;var f=i.$refs.dragger.width()/2*-1;var e=i.$refs.dragger.height()/2*-1;g.css({position:"relative"});i.$refs.wrapper.css({width:"100%",height:"100%"});i.$refs.dragger.css({position:"absolute","z-index":100,marginLeft:f,marginTop:e});i.$refs.front.css({"z-index":2,width:"100%",height:"100%",position:"absolute",overflow:"hidden","list-style":"none",left:0,top:0});i.$refs.back.css({"z-index":1,width:"100%",height:"100%",position:"absolute",overflow:"hidden","list-style":"none",left:0,top:0});switch(i.settings.direction.toUpperCase()){case"LR":i.$refs.front.width(h);i.$refs.dragger.css({left:h});break;case"RL":i.$refs.front.width(g.width()-h);i.$refs.dragger.css({left:g.width()-h});break;case"TB":i.$refs.front.height(h);i.$refs.dragger.css({top:h});break;case"BT":i.$refs.front.height(g.height()-h);i.$refs.dragger.css({top:g.height()-h});break}};d.prototype._resize=function(){var h=this,f=h.$this;var e;function g(){if(h.width!=f.width()){h.width=f.width()}if(h.height!=f.height()){h.height=f.height()}e=setTimeout(g,100)}g()};d.prototype._loadingState=function(){var f=this,e=f.$this;if(f.settings.animation===true){f.$refs.front.stop(true,false);f.$refs.dragger.stop(true,false)}f.is_loadingMedia=true;f.settings.callbackChangeMedia(f.getIndex(),f._onLoadingComplete,f)};d.prototype._onLoadingComplete=function(e){e.is_loadingMedia=false;if(e.settings.animation===true){e.animation()}};d.prototype.addSlide=function(g){var k=this,j=k.$this;var h=g.length;if(k.settings.navigation){var f="";for(var e=0;e<h;e++){f+="<li>"+(h+e+1)+"</li>"}k.$refs.navigation.append(f);k.$refs.navigation.children().click(function(){k._navigationChanged(c(this).index())})}k.total=k.total+h;if(k.total>1){k.multipleSlides=true}for(var e in g){k.$refs.slides.push(g[e])}};d.prototype.removeSlide=function(g){var m=this,l=m.$this;var e=m.getIndex();var k=g.length;m.total=m.total-k;if(m.total<2){m.multipleSlides=false}for(var h in g){m.$refs.navigation.children().each(function(i){if(i==g[h]){c(this).remove()}});m.$refs.slides[g[h]]=""}if(m.settings.navigation!=false){m._navigationActiveClass()}for(var f=0;f<m.$refs.slides.length;f++){if(m.$refs.slides[f]==""){m.$refs.slides.splice(f,1);f--}}m.$refs.front.hide().html(c(m.$refs.slides[e])).fadeIn(m.settings.navigationTransitionSpeed);e=(e-1>=0)?e-1:m.total;m.$refs.back.hide().html(c(m.$refs.slides[e])).fadeIn(m.settings.navigationTransitionSpeed)};d.prototype.navigation=function(){var j=this,h=j.$this;var g="";for(var f=0;f<j.$refs.slides.length;f++){g+="<li>"+(f+1)+"</li>"}var e='<ul class="navigation">'+g+"</ul>";h.prepend(e);j.$refs.navigation=h.find(".navigation");j.$refs.navigation.find("li:first-child").addClass("active");j.$refs.navigation.css("z-index",3).children().click(function(){j._navigationChanged(c(this).index())})};d.prototype._navigationChanged=function(e){var h=this,g=h.$this;var f=e;if(e+1==h.currentIndex||e==h.total&&h.currentIndex==0){return}if(h.settings.animation===true){h.$refs.front.stop(true,false);h.$refs.dragger.stop(true,false)}h.navigationChanged=true;h.currentIndex=(e+1<=h.total)?e+1:0;h.$refs.back.hide().html(c(h.$refs.slides[f])).fadeIn(h.settings.navigationTransitionSpeed);e=(e+1<=h.total)?e+1:0;h.$refs.front.hide().html(c(h.$refs.slides[e])).fadeIn(h.settings.navigationTransitionSpeed,function(){if(h.settings.animation===true){h.navigationChanged=false;h.animation()}});if(h.settings.navigation!=false){h._navigationActiveClass()}};d.prototype._navigationActiveClass=function(){var g=this,f=g.$this;g.$refs.navigation.children("li").removeClass("active");var e=g.getIndex();e=(e-1>=0)?e-1:g.total;g.$refs.navigation.children("li:eq("+e+")").addClass("active")};d.prototype._displayClassChangingMedia=function(){var f=this,e=f.$this;f.$refs.slider.addClass("changing-media");setTimeout(function(){f.$refs.slider.removeClass("changing-media")},f.settings.timeoutClassChangeMedia)};d.prototype.getIndex=function(){var f=this,e=f.$this;return f.currentIndex};d.prototype.updateIndex=function(){var f=this,e=f.$this;f.currentIndex=(f.currentIndex+1<=f.total)?f.currentIndex+1:0;if(f.settings.navigation!=false){f._navigationActiveClass()}f._changeMedia()};d.prototype.next=function(){var h=this,g=h.$this;var e=h.currentIndex;var f=e;if(h.settings.animation===true){h.$refs.front.stop(true,false);h.$refs.dragger.stop(true,false)}h.navigationChanged=true;h.$refs.back.hide().html(c(h.$refs.slides[f])).fadeIn(h.settings.navigationTransitionSpeed);e=(e+1<=h.total)?e+1:0;h.currentIndex=e;h.$refs.front.hide().html(c(h.$refs.slides[e])).fadeIn(h.settings.navigationTransitionSpeed,function(){if(h.settings.animation===true){h.navigationChanged=false;h.animation()}});if(h.settings.navigation!=false){h._navigationActiveClass()}};d.prototype.previous=function(){var h=this,g=h.$this;h.currentIndex=(h.currentIndex-1>=0)?h.currentIndex-1:h.total;var e=h.currentIndex;var f=e;if(h.settings.animation===true){h.$refs.front.stop(true,false);h.$refs.dragger.stop(true,false)}h.navigationChanged=true;h.$refs.back.hide().html(c(h.$refs.slides[f])).fadeIn(h.settings.navigationTransitionSpeed);e=(e-1>=0)?e-1:h.total;h.$refs.front.hide().html(c(h.$refs.slides[e])).fadeIn(h.settings.navigationTransitionSpeed,function(){if(h.settings.animation===true){h.navigationChanged=false;h.animation()}});if(h.settings.navigation!=false){h._navigationActiveClass()}};d.prototype._changeMedia=function(){var g=this,f=g.$this;var e=g.getIndex();if(g.settings.callbackChangeMedia!=null){g._loadingState()}else{g._displayClassChangingMedia()}if(g.changed=="back"){g.$refs.back.html(c(g.$refs.slides[e]));g.changed="front"}else{g.$refs.front.html(c(g.$refs.slides[e]));g.changed="back"}};d.prototype._disabledUserSelectionWhenMoving=function(g){var h=this,f=h.$this;h.$refs.wrapper.attr("unselectable","on");var e="-moz-none";if(g==="all"){e=g}f.css({"-webkit-user-select":g,"-khtml-user-select":g,"-moz-user-select":e,"-ms-user-select":g,"-o-user-select":g,"user-select":g});h.$refs.dragger.css({"-webkit-user-select":g,"-khtml-user-select":g,"-moz-user-select":e,"-ms-user-select":g,"-o-user-select":g,"user-select":g})};d.prototype.checkMousePositionToChangeMedia=function(){var h=this,g=h.$this;var f=h.settings.direction.toUpperCase();var e=(f=="LR"||f=="RL")?"X":"Y";if(h.multipleSlides){if(h.$refs.front.width()>=h.$refs.wrapper.width()-h.settings.changeMediaOffset&&h.changed=="back"&&e=="X"){h.updateIndex()}else{if(h.$refs.front.width()<=0+h.settings.changeMediaOffset&&h.changed=="front"&&e=="X"){h.updateIndex()}else{if(h.$refs.front.height()>=h.$refs.wrapper.height()-h.settings.changeMediaOffset&&h.changed=="back"&&e=="Y"){h.updateIndex()}else{if(h.$refs.front.height()<=0+h.settings.changeMediaOffset&&h.changed=="front"&&e=="Y"){h.updateIndex()}}}}}};d.prototype.mouseHandler=function(){var l=this,n=l.$this;var p=l.settings.direction.toUpperCase();var f=(p=="LR"||p=="RL")?"X":"Y";var j=0;var i=0;var g=0;var k=0;var h=0;var m=0;var e=String(l.settings.wrapperOffset);if(e.substr(e.length-1,e.length)=="%"){e=e.substr(0,e.length-1)}else{e=(f=="X")?e*100/n.width():e*100/n.height()}h=e;m=100-e;function o(){if(f=="X"){k=i*100/l.width}else{k=g*100/l.height}l.checkMousePositionToChangeMedia();if(k>=h&&k<=m){k=k+"%";if(f=="X"){l.$refs.front.width(k);l.$refs.dragger.css({left:k})}else{l.$refs.front.height(k);l.$refs.dragger.css({top:k})}}else{if(k>m){if(f=="X"){l.$refs.front.width(m+"%");l.$refs.dragger.css({left:m+"%"});if(l.$refs.front.width()>=l.$refs.wrapper.width()-l.settings.changeMediaOffset&&l.changed=="back"&&l.multipleSlides){l.updateIndex()}}else{l.$refs.front.height(m+"%");l.$refs.dragger.css({top:m+"%"});if(l.$refs.front.height()>=l.$refs.wrapper.height()-l.settings.changeMediaOffset&&l.changed=="back"&&l.multipleSlides){l.updateIndex()}}}else{if(k<h){if(f=="X"){l.$refs.front.width(h+"%");l.$refs.dragger.css({left:h+"%"});if(l.$refs.front.width()<=0+l.settings.changeMediaOffset&&l.changed=="front"&&l.multipleSlides){l.updateIndex()}}else{l.$refs.front.height(h+"%");l.$refs.dragger.css({top:h+"%"});if(l.$refs.front.height()<=0+l.settings.changeMediaOffset&&l.changed=="front"&&l.multipleSlides){l.updateIndex()}}}}}if(!l.settings.fixedDragger&&f=="X"){if(g*100/l.height>=0&&g*100/l.height<=100){l.$refs.dragger.css({top:(g*100/l.height)+"%"})}else{if(g*100/l.height>100){l.$refs.dragger.css({top:"100%"})}else{if(g*100/l.height<0){l.$refs.dragger.css({top:0})}}}}else{if(!l.settings.fixedDragger&&f=="Y"){if(i*100/l.width>=0&&i*100/l.width<=100){l.$refs.dragger.css({left:(i*100/l.width)+"%"})}else{if(i*100/l.width>100){l.$refs.dragger.css({left:"100%"})}else{if(i*100/l.width<0){l.$refs.dragger.css({left:0})}}}}}}l.$refs.slider.bind("touchstart",function(){l.$refs.front.stop(true,false);l.$refs.dragger.stop(true,false);l.is_mousedown=true;l.$refs.dragger.addClass("active");c(document).bind("touchmove",function(q){q.preventDefault();var r=q.originalEvent.touches[0]||q.originalEvent.changedTouches[0];j=n.offset();i=r.pageX-j.left;g=r.pageY-j.top;o()})});c(document).bind("touchend",function(q){c(this).unbind("touchmove");l.is_mousedown=false;if(l.settings.animation===true){l.animation()}l.$refs.dragger.removeClass("active")});l.$refs.dragger.mousedown(function(){if(l.settings.animation===true){l.$refs.front.stop(true,false);l.$refs.dragger.stop(true,false)}l.is_mousedown=true;l._disabledUserSelectionWhenMoving("none");c(this).addClass("active");c(document).bind("mousemove",function(q){j=n.offset();i=q.pageX-j.left;g=q.pageY-j.top;o()})});c(document).mouseup(function(q){l.is_mousedown=false;l._disabledUserSelectionWhenMoving("auto");l.$refs.dragger.removeClass("active");c(this).unbind("mousemove");if(l.settings.animation===true){l.animation()}})};d.prototype.animation=function(m,k){var n=this,s=n.$this;var t=n.settings.direction.toUpperCase();var i=(t=="LR"||t=="RL")?"X":"Y";var u=0;var l=n.settings.delay;var h=n.settings.speed;var r=n.settings.easing;if(m!==undefined){m=n._setPercentinPixel(m);u=m+"px";if(k!==undefined){l=(k.delay!==undefined)?k.delay:l;h=(k.speed!==undefined)?k.speed:h;r=(k.easing!==undefined)?k.easing:r}}else{var p=0;var j=0;var q=0;var e=String(n.settings.wrapperOffset);if(e.substr(e.length-1,e.length)=="%"){e=n._setPercentinPixel(e)}j=e;q=(i=="X")?s.width()-e:s.height()-e}var f;function o(){if(n.is_mousedown===false&&n.navigationChanged===false){if(m===undefined){p=(i=="X")?n.$refs.front.width():n.$refs.front.height();if(n.changed==="back"){u=q;p=100-p*100/q}else{u=j;p=p*100/q}h=p*n.settings.speed/100}var v;if(i=="X"){v=n.$refs.dragger.css("left");v=n._setPercentinPixel(v);n.$refs.dragger.css({left:v+"px"})}else{v=n.$refs.dragger.css("top");v=n._setPercentinPixel(v);n.$refs.dragger.css({top:v+"px"})}if(i=="X"){function x(){if(n.is_mousedown===false&&n.navigationChanged===false&&n.is_loadingMedia===false){n.$refs.front.animate({width:u},h,r);n.$refs.dragger.animate({left:u},h,r,g);clearTimeout(f)}}f=setTimeout(x,l)}else{function w(){if(n.is_mousedown===false&&n.navigationChanged===false&&n.is_loadingMedia===false){n.$refs.front.animate({height:u},h,r);n.$refs.dragger.animate({top:u},h,r,g);clearTimeout(f)}}f=setTimeout(w,l)}}}o();function g(){n.checkMousePositionToChangeMedia();if(!n.multipleSlides){if(n.changed==="back"){n.changed="front"}else{n.changed="back"}}if(m===undefined&&n.is_mousedown===false&&n.navigationChanged===false&&n.is_loadingMedia===false){o()}}};d.prototype.moveTo=function(e){var i=this,h=i.$this;var g=i.settings.direction.toUpperCase();var f=(g=="LR"||g=="RL")?"X":"Y";e=i._setPercentinPixel(e);e=e+"px";if(f=="X"){i.$refs.front.width(e);i.$refs.dragger.css({left:e})}else{i.$refs.front.height(e);i.$refs.dragger.css({top:e})}i.checkMousePositionToChangeMedia()};d.prototype._setPercentinPixel=function(e){var i=this,h=i.$this;e=String(e);if(e.substr(e.length-1,e.length-1)=="%"){e=e.substr(0,e.length-1)}else{return e}var g=i.settings.direction.toUpperCase();var f=(g=="LR"||g=="RL")?"X":"Y";if(f=="X"){e=e*i.width/100}else{e=e*i.height/100}return e};var a={init:function(e){return this.each(function(){var f=new d(this,e);c(this).data("reveal",f)})},next:function(){return this.each(function(){b(this,"next")})},previous:function(){return this.each(function(){b(this,"previous")})},animateTo:function(e,f){return this.each(function(){b(this,"animation",e,f)})},moveTo:function(e){return this.each(function(){b(this,"moveTo",e)})},addSlide:function(e){return this.each(function(){b(this,"addSlide",e)})},removeSlide:function(e){return this.each(function(){b(this,"removeSlide",e)})}};function b(f,g){var e=c(f).data("reveal");if(e){return e[g].apply(e,Array.prototype.slice.call(arguments,2))}}c.fn.reveal=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{c.error("Method "+e+" does not exist on jQuery.reveal")}}}})(jQuery);